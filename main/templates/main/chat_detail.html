<!DOCTYPE html>

{% load static %}
{% load naturaltime from humanize %}

<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="{% static 'main/css/chat_detail.css' %}">
    <title>{{ chat.name }}</title>
</head>
<body>
    <h1 id="title">Добро пожаловать в чат "{{ chat.name }}"</h1>
    <h2 id="auth">Вы вошли как:
        <i><a class="redirect" href="">{{ request.user.get_full_name|default:request.user.username }}</a></i>
    </h2>
    <div id="list_users">
        {% for user in chat.users.all %}
            <p><a class="redirect" href="">{{ user.username }}</a></p>
        {% endfor %}
    </div>

    {% if chat_messages %}
    <div class="messages">
        {% for message in chat_messages %}
            <div id="message" class="{% if request.user.id == message.owner_id_id and message.is_read.count != 1 or request.user.id != message.owner_id_id%}
                                        messages_us
                                     {% else %}
                                        unreaded
                                     {% endif %}"><input type="hidden" value="{{ message.owner_id_id }}">
                <div class="reply-body">
                    <strong>
                        <a class="username" href="{{ message.owner_id.get_absolute_url }}">
                            {{ message.owner_id.username }}
                        </a>
                    </strong>
                    <span class="pub_date">{{ message.pub_date|naturaltime }}</span>
                    <p class="text">{{ message.message|linebreaksbr|safe}}</p>
                </div>
            </div>
        {% endfor %}
    </div>
    {% else %}
        <div class="messages">
            <p class="no_messages">У вас пока нет сообщений!</p>
        </div>
    {% endif %}

    <div class="panel">
        <textarea id="chat-message-input" placeholder="Введите сообщение" required cols="85" rows="3"></textarea>
        <input type="button" id="chat-message-submit" value="Отправить">
    </div>

    {{ chat.slug|json_script:"chat_slug" }}
    <script src="/static/main/js/chat_detail.js"></script>
</body>
</html>